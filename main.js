(()=>{"use strict";var e=document.querySelector(".cards"),t=document.querySelector(".popup__input_type_place"),n=document.querySelector(".popup__input_type_link"),r=document.querySelector(".popup__save_button_create"),o=document.querySelector(".popup__close"),c=document.querySelector(".profile__button-edit"),u=document.querySelector(".profile__add-button"),a=document.querySelector(".popup__close_place"),i=document.querySelector(".popup__close_type_zoom"),l=document.querySelector(".popup_type_profile-edit"),s=document.querySelector(".popup__input_type_profession"),d=document.querySelector(".profile__name"),p=document.querySelector(".popup__input_type_name"),f=document.querySelector(".profile__profession"),_=document.querySelector(".popup__save_button_save"),v=document.querySelector(".popup_type_place"),y=document.querySelector(".popup_type_profile"),m=document.querySelector(".card-template").content.querySelector(".card"),h=document.querySelector(".popup__image"),S=document.querySelector(".popup__title_type_zoom"),b=document.querySelector(".popup_place"),q=document.querySelector(".popup_type_zoom"),E=document.querySelector(".popup__avatar"),k=document.querySelector(".profile__avatar-edit"),L=document.querySelector(".popup__close_type_avatar"),g=document.querySelector(".popup__save_button_avatar"),C=document.querySelector(".popup__body_type_avatar"),x=document.querySelector(".popup__input_type_avatar"),A=document.querySelector(".profile__photo"),w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_invalid",inputErrorClass:"popup__input_state_invalid",errorClass:"form__input-error"};function j(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.textContent=t?"Сохранение...":n?"Сохранить":"Создать"}function O(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B),e.addEventListener("click",P)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B),e.removeEventListener("click",P)}function P(e){e.target.classList.contains("popup")&&T(e.target)}function B(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&T(t)}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I={url:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{"Content-type":"application/json",Authorization:"3edacc12-bdb3-4557-94ae-de67f97aeffb"}},z=function(e){return e.ok?e.json():Promise.reject(e)},M=function(e,t,n){var r=e.querySelector(".card__like-button");e.querySelector(".card__like-counter").textContent=t.length,function(e,t){return Boolean(e.find((function(e){return e._id===t})))}(t,n)?r.classList.add("card__like-button_active"):r.classList.remove("card__like-button_active")};function N(e){return function(e){if(Array.isArray(e))return J(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var U=function(e,t,n){var r=e.validity.valid,o=t.querySelector("#".concat(e.id,"-error"));r?function(e,t,n){t.classList.remove(n.inputErrorClass),e.textContent=t.validationMessage}(o,e,n):function(e,t,n){t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(o,e,n)},H=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;t?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)};function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){N(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);e.addEventListener("submit",(function(e){e.preventDefault()})),N(n).forEach((function(n){n.addEventListener("input",(function(){U(n,e,t),H(r,e.checkValidity(),t)}))}))}(t,e)}))}(w),c.addEventListener("click",(function(){return O(l)})),c.addEventListener("click",(function(){return p.value=d.textContent,s.value=f.textContent,U(p,y,w),U(s,y,w),H(_,!0,w),void O(l)})),u.addEventListener("click",(function(){return O(b)})),o.addEventListener("click",(function(){return T(l)})),a.addEventListener("click",(function(){return T(b)})),i.addEventListener("click",(function(){return T(q)})),k.addEventListener("click",(function(){return O(E)})),L.addEventListener("click",(function(){return T(E)}));var V=null;Promise.all([fetch("".concat(I.url,"/cards"),{headers:I.headers}).then(z),fetch("".concat(I.url,"/users/me"),{headers:I.headers}).then(z)]).then((function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];d.textContent=u.name,f.textContent=u.about,A.src=u.avatar,V=u._id,c.reverse().forEach((function(t){G(t,e,V)}))})).catch((function(e){console.log(e)}));var F=function(e,t,n){var r,o;(r=e,o=t,fetch("".concat(I.url,"/cards/likes/").concat(r),{method:o?"DELETE":"PUT",headers:I.headers}).then(z)).then((function(e){M(n,e.likes,V)})).catch((function(e){console.log(e)}))},G=function(e,t,n){var r=function(e,t,n){var r=m.cloneNode(!0),o=r.querySelector(".card__photo"),c=r.querySelector(".card__place"),u=r.querySelector(".card__trash"),a=r.querySelector(".card__like-button");return r.querySelector(".card__like-counter").textContent=0,o.src=e.link,o.alt=e._id,c.textContent=e.name,M(r,e.likes,t),e.owner._id===t&&(u.style.display="block"),o.addEventListener("click",(function(){h.src=o.src,h.alt=c.textContent,S.textContent=c.textContent,O(q)})),a.addEventListener("click",(function(){n(e._id,a.classList.contains("card__like-button_active"),r)})),u.addEventListener("click",(function(){return function(e,t){var n;console.log(e),(n=e._id,fetch("".concat(I.url,"/cards/").concat(n),{headers:I.headers,method:"DELETE"}).then(z)).then((function(e){t.remove()})).catch((function(e){console.log(e)}))}(e,r)})),r}(e,n,F);t.prepend(r)};C.addEventListener("submit",(function(e){var t;e.preventDefault(),j(g,!0),(t={avatar:A.src},fetch("".concat(I.url,"/users/me/avatar"),{headers:I.headers,method:"PATCH",body:JSON.stringify(t)}).then(z)).then((function(e){A.src=x.value,A.alt=x.name,H(g,!1,w),A.src=e.avatar,C.reset(),T(E)})).catch((function(e){console.log(e)})).finally((function(){return j(g,!1)}))})),y.addEventListener("submit",(function(e){var t,n;e.preventDefault(),j(_,!0),(t={name:d.textContent,about:f.textContent,link:"users/me"},fetch("".concat(I.url,"/").concat(t.link),(n={headers:I.headers,method:"PATCH"},D(n,"headers",I.headers),D(n,"body",JSON.stringify(t)),n)).then(z)).then((function(e){d.textContent=p.value,f.textContent=s.value,T(l)})).catch((function(e){console.log(e)})).finally((function(){return j(_,!1)}))})),v.addEventListener("submit",(function(o){var c,u;o.preventDefault(),j(r,!0),(c={name:t.value,link:n.value,owner:{_id:V}},fetch("".concat(I.url,"/cards"),(u={headers:I.headers,method:"POST"},D(u,"headers",I.headers),D(u,"body",JSON.stringify(c)),u)).then(z)).then((function(t){v.reset(),G(t,e,V),H(r,!1,w),T(b)})).catch((function(e){console.log(e)})).finally((function(){return j(r,!1,!1)}))}))})();